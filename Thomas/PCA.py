# -*- coding: utf-8 -*-
"""
Created on Mon Oct  4 12:19:24 2021

@author: Thomas M Thoppil
"""

import numpy as np
import pandas as pd
from sklearn.decomposition import PCA
df = pd.read_csv("D:/packt/Project/1019_Microsoft_Malware_Detection/Dataset/Malware_Classification.csv/Malware_Classification.csv")

df.drop(['ID',"MajorImageVersion","Unnamed: 57"], axis=1, inplace=True)
df.drop(['Machine','legitimate','md5'], axis = 1, inplace =True)
def remove_multicoll(CORR, threshold=0.8):
    '''
    removing all features with corr above threshold
    '''
    l = []
    for i in CORR.columns:
        for x,j in enumerate(CORR[i]):
            if j>threshold:
                if i != CORR.columns[x]:
                    l.append((i,CORR.columns[x]))
    for i in l:
        for j in l:
            if i==j:
                l.remove(j)
    
    Remove = []
    keep = []
    for i in l:
        if i[0] not in keep:
            keep.append(i[0])
        if i[1] not in Remove:
            Remove.append(i[1])
    return Remove, keep

R, k = remove_multicoll(df.corr())
df.drop(R, axis=1, inplace=True)
print(R)
X = df
pca = PCA(n_components=len(X.columns))
pca.fit(X)
req_list = [i for i in pca.explained_variance_ratio_ if i>=0.1]
print(req_list)
#print(pca.explained_variance_ratio_)
#print(pca.singular_values_)
